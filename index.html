<!DOCTYPE html>
<html>
<head>
 <meta http-equiv="content-type" content="text/html; charset=utf-8" />
 <!-- midi.js package -->
 <script src="./js/MIDI/AudioDetect.js" type="text/javascript"></script>
 <script src="./js/MIDI/LoadPlugin.js" type="text/javascript"></script>
 <script src="./js/MIDI/Plugin.js" type="text/javascript"></script>
 <script src="./js/MIDI/Player.js" type="text/javascript"></script>
 <script src="./js/Window/DOMLoader.XMLHttp.js" type="text/javascript"></script>
 <script src="./js/Window/DOMLoader.script.js" type="text/javascript"></script>
 <!-- extras -->
 <script src="./inc/WebMIDIAPI.js" type="text/javascript"></script>
 <script src="./inc/Base64.js" type="text/javascript"></script>
 <script src="./inc/base64binary.js" type="text/javascript"></script>
 <!-- jQuery -->
 <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js">
</script>
</head>
<body>
<script>

//          [top rec offset, top rec width, bottom rec offset, bottom rec width]
//          There are 85 keys. The lowest note is 21 and the highest is 108.
var keys = [
            [4,7,0,15],         // 0  - WHITE
            [11,11,0,0],        // 1  - BLACK
            [21,11,17,15],      // 2  - WHITE
            [34,10,34,15],      // 3  - WHITE
            [43,11,0,0],        // 4  - BLACK
            [54,9,51,15],      // 5  - WHITE
            [62,11,0,0],        // 6  - BLACK
            [72,11,68,15],     // 7  - WHITE
            [85,11,85,15],      // 8  - WHITE
            [95,10,0,0],       // 9  - BLACK
            [105,8,102,15],     // 10 - WHITE
            [113,10,0,0]        // 11 - BLACK
           ];

window.onload = function () {
	MIDI.loadPlugin({
		soundfontUrl: "./soundfont/",
		instrument: "acoustic_grand_piano",
		callback: function() {
			var delay = 0; // play one note every quarter second
			var note = 66; // the MIDI note
			var velocity = 127; // how hard the note hits
			// play the note
			MIDI.setVolume(0, 127);
			MIDI.noteOn(0, note, velocity, delay);                        
                        var key = note - 21;
                        var idxKey = key%12;
                        var octave = Math.floor(key/12);
                        debug("Note="+note+"<br>Key="+key+"<br>idxKey="+idxKey+"<br>octave="+octave);
                        topRecOffset = 7 + keys[idxKey][0] + 119 * octave;
                        botRecOffset = 7 + keys[idxKey][2] + 119 * octave;
                        var topRec='<div id="note" style="position: absolute; top: 211px; left: '+topRecOffset+'px; background-color:red;width:'+keys[idxKey][1]+'px;height:42px;border:0px solid #000"></div>';
                        var botRec='<div id="note" style="position: absolute; top: 253px; left: '+botRecOffset+'px; background-color:red;width:'+keys[idxKey][3]+'px;height:31px;border:0px solid #000"></div>';
                        $("img").after(topRec);
                        $("img").after(botRec);

                        var duration = 0.75
			//MIDI.noteOff(0, note,     delay + duration);
                        setTimeout(function() {
                            $("#noe").remove();
                            MIDI.noteOff(0, note, 0);
                        }, duration*1000);
		}
	});
};

function debug(param)
{
    $("div").after(param);
}
</script>
<div style="position: relative; left: 0; top: 0;">
  <img src="images/PianoKeyboard.jpg" style="position: relative; top: 0; left: 0;" width="895" height="450"/>
<!--  <img src="images/BlackKey_LeftHand.png" style="position: absolute; top: 211px; left: 51px;" width="11" height="43"/>
  <img src="images/WhiteKeyLeft_LeftHand.png" style="position: absolute; top: 210px; left: 7px;" width="17" height="74"/>
  <img src="images/WhiteKeyMiddle_LeftHand.png" style="position: absolute; top: 210px; left: 110px;" width="17" height="74"/>
  <img src="images/WhiteKeyRight_LeftHand.png" style="position: absolute; top: 210px; left: 75px;" width="17" height="74"/>
  
  <img src="images/BlackKey_RightHand.png" style="position: absolute; top: 211px; left: 427px;" width="11" height="43"/>
  <img src="images/WhiteKeyLeft_RightHand.png" style="position: absolute; top: 210px; left: 400px;" width="17" height="74"/>
  <img src="images/WhiteKeyMiddle_RightHand.png" style="position: absolute; top: 210px; left: 468px;" width="17" height="74"/>
  <img src="images/WhiteKeyRight_RightHand.png" style="position: absolute; top: 210px; left: 502px;" width="17" height="74"/>
-->
</div>
    
</body>
</html>